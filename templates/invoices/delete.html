{% extends 'base.html' %}
{% load static %}

{% block title %}Delete {{ invoice.invoice_number }} - Ralfiz BMS{% endblock %}

{% block breadcrumb %}
<a href="{% url 'dashboard' %}" class="breadcrumb-item">Dashboard</a>
<span class="breadcrumb-separator">/</span>
<a href="{% url 'invoice_list' %}" class="breadcrumb-item">Invoices</a>
<span class="breadcrumb-separator">/</span>
<a href="{% url 'invoice_detail' invoice.pk %}" class="breadcrumb-item">{{ invoice.invoice_number }}</a>
<span class="breadcrumb-separator">/</span>
<span class="breadcrumb-item active">Delete</span>
{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-6 col-md-8 col-sm-12" style="padding: 0.75rem;">
    <div class="card">
      <div class="card-header" style="background: var(--danger-bg); border-bottom-color: #fecaca;">
        <div class="d-flex align-items-center gap-3">
          <div style="width: 48px; height: 48px; background: var(--danger); border-radius: var(--border-radius); display: flex; align-items: center; justify-content: center;">
            <i class="fas fa-exclamation-triangle text-white" style="font-size: 1.25rem;"></i>
          </div>
          <div>
            <h3 class="card-title mb-0" style="color: var(--danger);">Delete Invoice</h3>
            <p class="text-sm mb-0" style="color: var(--danger);">This action cannot be undone</p>
          </div>
        </div>
      </div>
      <div class="card-body">
        <p class="text-secondary mb-4">
          Are you sure you want to delete the invoice <strong>"{{ invoice.invoice_number }}"</strong>?
        </p>

        <!-- Invoice Summary -->
        <div class="p-3 rounded mb-4" style="background: var(--bg-body);">
          <div class="d-flex align-items-center justify-content-between mb-3">
            <div>
              <div class="fw-medium">{{ invoice.invoice_number }}</div>
              <div class="text-sm text-muted">{{ invoice.title }}</div>
            </div>
            <span class="status-badge {{ invoice.status }}">{{ invoice.get_status_display }}</span>
          </div>
          <div class="row">
            <div class="col-3">
              <div class="text-sm text-muted">Client</div>
              <div class="fw-medium">{{ invoice.client.name }}</div>
            </div>
            <div class="col-3">
              <div class="text-sm text-muted">Total</div>
              <div class="fw-medium">&#8377;{{ invoice.total_amount|floatformat:0 }}</div>
            </div>
            <div class="col-3">
              <div class="text-sm text-muted">Paid</div>
              <div class="fw-medium text-success">&#8377;{{ invoice.amount_paid|floatformat:0|default:"0" }}</div>
            </div>
            <div class="col-3">
              <div class="text-sm text-muted">Payments</div>
              <div class="fw-medium">{{ invoice.payments.count }}</div>
            </div>
          </div>
        </div>

        {% if invoice.payments.count > 0 %}
        <div class="alert alert-warning">
          <i class="fas fa-info-circle alert-icon"></i>
          <div class="alert-content">
            <div class="alert-title">Cannot delete this invoice</div>
            <p class="alert-text mb-0">
              This invoice has {{ invoice.payments.count }} payment(s) recorded against it totaling &#8377;{{ invoice.amount_paid|floatformat:0 }}.
              Payments must be deleted first before the invoice can be removed.
            </p>
          </div>
        </div>
        {% endif %}

        <form method="post" class="d-flex gap-3 justify-content-end mt-4">
          {% csrf_token %}
          <a href="{% url 'invoice_detail' invoice.pk %}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left"></i>
            Cancel
          </a>
          <button type="submit" class="btn btn-danger" {% if invoice.payments.count > 0 %}disabled{% endif %}>
            <i class="fas fa-trash-alt"></i>
            Delete Invoice
          </button>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}
