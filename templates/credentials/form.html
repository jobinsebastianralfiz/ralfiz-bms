{% extends 'base.html' %}
{% load static %}

{% block title %}{{ form_title }} - Ralfiz BMS{% endblock %}

{% block breadcrumb %}
<a href="{% url 'dashboard' %}" class="breadcrumb-item">Dashboard</a>
<span class="breadcrumb-separator">/</span>
<a href="{% url 'credential_list' %}" class="breadcrumb-item">Credentials</a>
<span class="breadcrumb-separator">/</span>
<span class="breadcrumb-item active">{{ form_title }}</span>
{% endblock %}

{% block content %}
<div class="page-header">
  <div>
    <h1 class="page-title">{{ form_title }}</h1>
  </div>
</div>

<form method="post">
  {% csrf_token %}
  <div class="row">
    <div class="col-8 col-md-12" style="padding: 0.75rem;">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title"><i class="fas fa-key me-2 text-primary"></i>Credential Information</h3>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-6 col-sm-12" style="padding: 0.5rem;">
              <div class="form-group">
                <label class="form-label" for="name">Name <span class="required">*</span></label>
                <input type="text" class="form-control" id="name" name="name" value="{{ credential.name|default:'' }}" required>
              </div>
            </div>
            <div class="col-6 col-sm-12" style="padding: 0.5rem;">
              <div class="form-group">
                <label class="form-label" for="project">Project <span class="required">*</span></label>
                <select class="form-control" id="project" name="project" required>
                  <option value="">Select project</option>
                  {% for project in projects %}
                  <option value="{{ project.pk }}" {% if credential.project.pk == project.pk %}selected{% endif %}>{{ project.name }} ({{ project.client.name }})</option>
                  {% endfor %}
                </select>
              </div>
            </div>
            <div class="col-6 col-sm-12" style="padding: 0.5rem;">
              <div class="form-group">
                <label class="form-label" for="credential_type">Type</label>
                <select class="form-control" id="credential_type" name="credential_type">
                  {% for key, value in type_choices %}
                  <option value="{{ key }}" {% if credential.credential_type == key %}selected{% endif %}>{{ value }}</option>
                  {% endfor %}
                </select>
              </div>
            </div>
            <div class="col-6 col-sm-12" style="padding: 0.5rem;">
              <div class="form-group">
                <label class="form-label" for="provider">Provider</label>
                <input type="text" class="form-control" id="provider" name="provider" placeholder="e.g., GoDaddy, AWS" value="{{ credential.provider|default:'' }}">
              </div>
            </div>
            <div class="col-12" style="padding: 0.5rem;">
              <div class="form-group">
                <label class="form-label" for="url">URL</label>
                <input type="url" class="form-control" id="url" name="url" placeholder="https://..." value="{{ credential.url|default:'' }}">
              </div>
            </div>
            <div class="col-6 col-sm-12" style="padding: 0.5rem;">
              <div class="form-group">
                <label class="form-label" for="username">Username</label>
                <input type="text" class="form-control" id="username" name="username" value="{{ credential.username|default:'' }}">
              </div>
            </div>
            <div class="col-6 col-sm-12" style="padding: 0.5rem;">
              <div class="form-group">
                <label class="form-label" for="password">Password</label>
                <input type="text" class="form-control" id="password" name="password" value="{{ credential.password|default:'' }}">
              </div>
            </div>
            <div class="col-6 col-sm-12" style="padding: 0.5rem;">
              <div class="form-group">
                <label class="form-label" for="expiry_date">Expiry Date</label>
                <input type="date" class="form-control" id="expiry_date" name="expiry_date" value="{{ credential.expiry_date|date:'Y-m-d'|default:'' }}">
              </div>
            </div>
            {% if credential %}
            <div class="col-6 col-sm-12" style="padding: 0.5rem;">
              <div class="form-group">
                <label class="form-label">Status</label>
                <div class="form-check">
                  <input type="checkbox" class="form-check-input" id="is_active" name="is_active" {% if credential.is_active %}checked{% endif %}>
                  <label class="form-check-label" for="is_active">Active</label>
                </div>
              </div>
            </div>
            {% endif %}
            <div class="col-12" style="padding: 0.5rem;">
              <div class="form-group mb-0">
                <label class="form-label" for="notes">Notes</label>
                <textarea class="form-control" id="notes" name="notes" rows="3">{{ credential.notes|default:'' }}</textarea>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card mt-4">
    <div class="card-body d-flex justify-content-between align-items-center">
      <a href="{% url 'credential_list' %}" class="btn btn-outline-secondary"><i class="fas fa-arrow-left me-2"></i>Cancel</a>
      <button type="submit" class="btn btn-primary"><i class="fas fa-check me-2"></i>{% if credential %}Update{% else %}Save{% endif %}</button>
    </div>
  </div>
</form>
{% endblock %}
