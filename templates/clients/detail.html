{% extends 'base.html' %}
{% load static %}

{% block title %}{{ client.name }} - Ralfiz BMS{% endblock %}

{% block extra_css %}
<style>
  .tabs {
    display: flex;
    gap: 0.5rem;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 0;
  }

  .tab-item {
    padding: 0.75rem 1.25rem;
    border: none;
    background: none;
    color: var(--text-secondary);
    font-weight: 500;
    font-size: 0.875rem;
    cursor: pointer;
    border-bottom: 2px solid transparent;
    margin-bottom: -1px;
    transition: all 0.2s;
    display: flex;
    align-items: center;
  }

  .tab-item:hover {
    color: var(--primary);
    background: var(--primary-bg);
  }

  .tab-item.active {
    color: var(--primary);
    border-bottom-color: var(--primary);
    background: transparent;
  }

  .tab-content.d-none {
    display: none;
  }

  .avatar-xl {
    width: 72px;
    height: 72px;
    font-size: 1.5rem;
  }

  .priority-badge {
    display: inline-flex;
    align-items: center;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 500;
  }

  .priority-badge.high {
    background: #fef2f2;
    color: #dc2626;
  }

  .priority-badge.medium {
    background: #fffbeb;
    color: #d97706;
  }

  .priority-badge.low {
    background: #f0fdf4;
    color: #16a34a;
  }
</style>
{% endblock %}

{% block breadcrumb %}
<a href="{% url 'dashboard' %}" class="breadcrumb-item">Dashboard</a>
<span class="breadcrumb-separator">/</span>
<a href="{% url 'client_list' %}" class="breadcrumb-item">Clients</a>
<span class="breadcrumb-separator">/</span>
<span class="breadcrumb-item active">{{ client.name }}</span>
{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header">
  <div class="d-flex align-items-center gap-4">
    <div class="avatar avatar-xl">{{ client.name|slice:":2"|upper }}</div>
    <div>
      <div class="d-flex align-items-center gap-3 mb-2">
        <h1 class="page-title mb-0">{{ client.name }}</h1>
        <span class="priority-badge {{ client.priority }}">{{ client.get_priority_display }} Priority</span>
        {% if client.is_active %}
        <span class="badge badge-success">Active</span>
        {% else %}
        <span class="badge badge-secondary">Inactive</span>
        {% endif %}
      </div>
      <p class="page-subtitle mb-0">
        {% if client.address %}
        <i class="fas fa-map-marker-alt me-2"></i>{{ client.address|truncatewords:5 }}
        <span class="mx-2">|</span>
        {% endif %}
        <i class="fas fa-calendar me-2"></i>Client since {{ client.created_at|date:"M Y" }}
      </p>
    </div>
  </div>
  <div class="page-actions">
    <a href="{% url 'project_create' %}?client={{ client.pk }}" class="btn btn-outline-primary">
      <i class="fas fa-folder-plus"></i>
      New Project
    </a>
    <a href="{% url 'quote_create' %}?client={{ client.pk }}" class="btn btn-outline-primary">
      <i class="fas fa-file-alt"></i>
      Create Quote
    </a>
    <a href="{% url 'client_update' client.pk %}" class="btn btn-primary">
      <i class="fas fa-edit"></i>
      Edit Client
    </a>
    <a href="{% url 'client_delete' client.pk %}" class="btn btn-danger">
      <i class="fas fa-trash-alt"></i>
      Delete
    </a>
  </div>
</div>

<!-- Stats Cards -->
<div class="row mb-4">
  <div class="col-3 col-md-6 col-sm-12" style="padding: 0.75rem;">
    <div class="card stat-card">
      <div class="stat-card-header">
        <div class="stat-card-icon primary">
          <i class="fas fa-folder-open"></i>
        </div>
      </div>
      <div class="stat-card-value">{{ projects.count }}</div>
      <div class="stat-card-label">Total Projects</div>
    </div>
  </div>
  <div class="col-3 col-md-6 col-sm-12" style="padding: 0.75rem;">
    <div class="card stat-card">
      <div class="stat-card-header">
        <div class="stat-card-icon success">
          <i class="fas fa-rupee-sign"></i>
        </div>
      </div>
      <div class="stat-card-value">&#8377;{{ total_revenue|floatformat:0|default:"0" }}</div>
      <div class="stat-card-label">Total Revenue</div>
    </div>
  </div>
  <div class="col-3 col-md-6 col-sm-12" style="padding: 0.75rem;">
    <div class="card stat-card">
      <div class="stat-card-header">
        <div class="stat-card-icon warning">
          <i class="fas fa-file-invoice"></i>
        </div>
      </div>
      <div class="stat-card-value">&#8377;{{ pending_amount|floatformat:0|default:"0" }}</div>
      <div class="stat-card-label">Pending Amount</div>
    </div>
  </div>
  <div class="col-3 col-md-6 col-sm-12" style="padding: 0.75rem;">
    <div class="card stat-card">
      <div class="stat-card-header">
        <div class="stat-card-icon info">
          <i class="fas fa-key"></i>
        </div>
      </div>
      <div class="stat-card-value">{{ credentials_count|default:"0" }}</div>
      <div class="stat-card-label">Credentials</div>
    </div>
  </div>
</div>

<!-- Main Content Grid -->
<div class="row">
  <!-- Left Column - Client Details -->
  <div class="col-4 col-md-12" style="padding: 0.75rem;">
    <!-- Contact Information -->
    <div class="card mb-4">
      <div class="card-header">
        <h3 class="card-title">Contact Information</h3>
      </div>
      <div class="card-body">
        {% if client.company_name %}
        <div class="mb-3">
          <div class="text-sm text-muted mb-1">Contact Person</div>
          <div class="fw-medium">{{ client.name }}</div>
        </div>
        {% endif %}
        <div class="mb-3">
          <div class="text-sm text-muted mb-1">Email</div>
          <div>
            <a href="mailto:{{ client.email }}" class="d-flex align-items-center gap-2">
              <i class="fas fa-envelope"></i>
              {{ client.email }}
            </a>
          </div>
        </div>
        {% if client.phone %}
        <div class="mb-3">
          <div class="text-sm text-muted mb-1">Phone</div>
          <div>
            <a href="tel:{{ client.phone }}" class="d-flex align-items-center gap-2">
              <i class="fas fa-phone"></i>
              {{ client.phone }}
            </a>
          </div>
        </div>
        {% endif %}
        {% if client.whatsapp %}
        <div class="mb-3">
          <div class="text-sm text-muted mb-1">WhatsApp</div>
          <div>
            <a href="https://wa.me/{{ client.whatsapp }}" target="_blank" class="d-flex align-items-center gap-2">
              <i class="fab fa-whatsapp"></i>
              {{ client.whatsapp }}
            </a>
          </div>
        </div>
        {% endif %}
        {% if client.address %}
        <div>
          <div class="text-sm text-muted mb-1">Address</div>
          <div class="text-secondary">
            <i class="fas fa-map-marker-alt me-2"></i>
            {{ client.address|linebreaksbr }}
          </div>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Business Information -->
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">Business Information</h3>
      </div>
      <div class="card-body">
        {% if client.company_name %}
        <div class="mb-3">
          <div class="text-sm text-muted mb-1">Company Name</div>
          <div class="fw-medium">{{ client.company_name }}</div>
        </div>
        {% endif %}
        {% if client.gst_number %}
        <div class="mb-3">
          <div class="text-sm text-muted mb-1">GST Number</div>
          <div class="fw-medium">{{ client.gst_number }}</div>
        </div>
        {% endif %}
        {% if client.notes %}
        <div>
          <div class="text-sm text-muted mb-1">Notes</div>
          <div class="text-secondary">
            {{ client.notes|linebreaks }}
          </div>
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Right Column - Projects, Invoices, Quotes, Payments -->
  <div class="col-8 col-md-12" style="padding: 0.75rem;">
    <!-- Tabs -->
    <div class="card">
      <div class="card-header" style="padding-bottom: 0; border-bottom: none;">
        <div class="tabs">
          <button class="tab-item active" data-tab="projectsTab" onclick="switchTab('projectsTab')">
            <i class="fas fa-folder-open me-2"></i>Projects
          </button>
          <button class="tab-item" data-tab="invoicesTab" onclick="switchTab('invoicesTab')">
            <i class="fas fa-file-invoice-dollar me-2"></i>Invoices
          </button>
          <button class="tab-item" data-tab="quotesTab" onclick="switchTab('quotesTab')">
            <i class="fas fa-file-alt me-2"></i>Quotes
          </button>
          <button class="tab-item" data-tab="paymentsTab" onclick="switchTab('paymentsTab')">
            <i class="fas fa-credit-card me-2"></i>Payments
          </button>
          <button class="tab-item" data-tab="licensesTab" onclick="switchTab('licensesTab')">
            <i class="fas fa-key me-2"></i>Licenses
          </button>
          <button class="tab-item" data-tab="retaileaseTab" onclick="switchTab('retaileaseTab')">
            <i class="fas fa-mobile-alt me-2"></i>RetailEase App
          </button>
          <button class="tab-item" data-tab="backupsTab" onclick="switchTab('backupsTab')">
            <i class="fas fa-cloud-upload-alt me-2"></i>Backups
          </button>
        </div>
      </div>

      <!-- Projects Tab -->
      <div class="tab-content" id="projectsTab">
        <div class="table-wrapper">
          <table class="table">
            <thead>
              <tr>
                <th>Project</th>
                <th>Type</th>
                <th>Status</th>
                <th>Amount</th>
                <th>Deadline</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              {% for project in projects %}
              <tr>
                <td>
                  <a href="{% url 'project_detail' project.pk %}" class="fw-medium">{{ project.name }}</a>
                  {% if project.tech_stack %}
                  <div class="text-sm text-muted">{{ project.tech_stack|truncatewords:5 }}</div>
                  {% endif %}
                </td>
                <td><span class="badge badge-info">{{ project.get_project_type_display }}</span></td>
                <td><span class="status-badge {{ project.status }}">{{ project.get_status_display }}</span></td>
                <td class="fw-medium">&#8377;{{ project.estimated_budget|floatformat:0|default:"-" }}</td>
                <td>{{ project.deadline|date:"d M Y"|default:"-" }}</td>
                <td>
                  <a href="{% url 'project_detail' project.pk %}" class="btn btn-sm btn-ghost btn-icon">
                    <i class="fas fa-arrow-right"></i>
                  </a>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="6" class="text-center py-4 text-muted">No projects yet</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <!-- Invoices Tab -->
      <div class="tab-content d-none" id="invoicesTab">
        <div class="table-wrapper">
          <table class="table">
            <thead>
              <tr>
                <th>Invoice #</th>
                <th>Project</th>
                <th>Amount</th>
                <th>Due Date</th>
                <th>Status</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              {% for invoice in invoices %}
              <tr>
                <td><a href="{% url 'invoice_detail' invoice.pk %}" class="fw-medium">{{ invoice.invoice_number }}</a></td>
                <td>{{ invoice.project.name|default:"-" }}</td>
                <td class="fw-medium">&#8377;{{ invoice.total_amount|floatformat:0 }}</td>
                <td>{{ invoice.due_date|date:"d M Y"|default:"-" }}</td>
                <td><span class="status-badge {{ invoice.status }}">{{ invoice.get_status_display }}</span></td>
                <td>
                  <a href="{% url 'invoice_detail' invoice.pk %}" class="btn btn-sm btn-ghost btn-icon">
                    <i class="fas fa-arrow-right"></i>
                  </a>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="6" class="text-center py-4 text-muted">No invoices yet</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <!-- Quotes Tab -->
      <div class="tab-content d-none" id="quotesTab">
        <div class="table-wrapper">
          <table class="table">
            <thead>
              <tr>
                <th>Quote #</th>
                <th>Title</th>
                <th>Amount</th>
                <th>Valid Until</th>
                <th>Status</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              {% for quote in quotes %}
              <tr>
                <td><a href="{% url 'quote_detail' quote.pk %}" class="fw-medium">{{ quote.quote_number }}</a></td>
                <td>{{ quote.title }}</td>
                <td class="fw-medium">&#8377;{{ quote.total_amount|floatformat:0 }}</td>
                <td>{{ quote.valid_until|date:"d M Y"|default:"-" }}</td>
                <td><span class="status-badge {{ quote.status }}">{{ quote.get_status_display }}</span></td>
                <td>
                  <a href="{% url 'quote_detail' quote.pk %}" class="btn btn-sm btn-ghost btn-icon">
                    <i class="fas fa-arrow-right"></i>
                  </a>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="6" class="text-center py-4 text-muted">No quotes yet</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <!-- Payments Tab -->
      <div class="tab-content d-none" id="paymentsTab">
        <div class="table-wrapper">
          <table class="table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Invoice</th>
                <th>Amount</th>
                <th>Method</th>
                <th>Transaction ID</th>
              </tr>
            </thead>
            <tbody>
              {% for payment in payments %}
              <tr>
                <td>{{ payment.payment_date|date:"d M Y" }}</td>
                <td><a href="{% url 'invoice_detail' payment.invoice.pk %}">{{ payment.invoice.invoice_number }}</a></td>
                <td class="fw-medium text-success">&#8377;{{ payment.amount|floatformat:0 }}</td>
                <td><span class="badge badge-info">{{ payment.get_payment_method_display }}</span></td>
                <td class="text-muted">{{ payment.transaction_id|default:"-" }}</td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="5" class="text-center py-4 text-muted">No payments yet</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <!-- Licenses Tab -->
      <div class="tab-content d-none" id="licensesTab">
        <div class="table-wrapper">
          <table class="table">
            <thead>
              <tr>
                <th>Customer</th>
                <th>Type</th>
                <th>Status</th>
                <th>Valid Until</th>
                <th>Activations</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              {% for license in licenses %}
              <tr>
                <td class="fw-medium">{{ license.customer_name }}</td>
                <td><span class="badge badge-info">{{ license.get_license_type_display }}</span></td>
                <td>
                  {% if license.status == 'active' %}
                  <span class="status-badge success">Active</span>
                  {% elif license.status == 'expired' %}
                  <span class="status-badge danger">Expired</span>
                  {% else %}
                  <span class="status-badge warning">{{ license.get_status_display }}</span>
                  {% endif %}
                </td>
                <td>{{ license.valid_until|date:"d M Y" }}</td>
                <td>{{ license.current_activations }}/{{ license.max_activations }}</td>
                <td>
                  <a href="{% url 'license_detail' license.pk %}" class="btn btn-sm btn-ghost btn-icon">
                    <i class="fas fa-eye"></i>
                  </a>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="6" class="text-center py-4 text-muted">No licenses linked to this client</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        <div class="card-footer" style="border-top: 1px solid var(--border-color); padding: 1rem;">
          <a href="{% url 'license_create' %}?client={{ client.pk }}" class="btn btn-primary btn-sm">
            <i class="fas fa-plus me-2"></i>Create License
          </a>
        </div>
      </div>

      <!-- RetailEase App Tab -->
      <div class="tab-content d-none" id="retaileaseTab">
        <form method="post" action="{% url 'client_update_retailease' client.pk %}">
          {% csrf_token %}
          <div class="card-body">
            <!-- Google Drive Backup Section -->
            <div class="mb-4">
              <h5 class="mb-3"><i class="fab fa-google-drive me-2"></i>Google Drive Backup</h5>
              <p class="text-muted text-sm mb-3">
                Configure Google OAuth credentials for this client's Google Drive backup.
                Get credentials from <a href="https://console.cloud.google.com" target="_blank">Google Cloud Console</a>.
              </p>
              <div class="row">
                <div class="col-6 mb-3">
                  <label class="form-label">Client ID (Desktop)</label>
                  <input type="text" class="form-control" name="google_client_id"
                         value="{{ client.google_client_id|default:'' }}"
                         placeholder="xxxxx.apps.googleusercontent.com">
                  <small class="text-muted">For macOS, Windows, Linux</small>
                </div>
                <div class="col-6 mb-3">
                  <label class="form-label">Client Secret (Desktop)</label>
                  <div class="input-group">
                    <input type="password" class="form-control" name="google_client_secret" id="clientSecret"
                           value="{{ client.google_client_secret|default:'' }}"
                           placeholder="GOCSPX-xxxxxxxxxxxxxx">
                    <button type="button" class="btn btn-outline-secondary" onclick="toggleSecretVisibility()">
                      <i class="fas fa-eye" id="secretToggleIcon"></i>
                    </button>
                  </div>
                  <small class="text-muted">Required for desktop OAuth</small>
                </div>
                <div class="col-6 mb-3">
                  <label class="form-label">Reversed Client ID (iOS)</label>
                  <input type="text" class="form-control" name="google_reversed_client_id"
                         value="{{ client.google_reversed_client_id|default:'' }}"
                         placeholder="com.googleusercontent.apps.xxxxx">
                </div>
                <div class="col-6 mb-3">
                  <label class="form-label">Client ID (iOS)</label>
                  <input type="text" class="form-control" name="google_client_id_ios"
                         value="{{ client.google_client_id_ios|default:'' }}"
                         placeholder="iOS Client ID">
                </div>
                <div class="col-6 mb-3">
                  <label class="form-label">Client ID (Android)</label>
                  <input type="text" class="form-control" name="google_client_id_android"
                         value="{{ client.google_client_id_android|default:'' }}"
                         placeholder="Android Client ID">
                </div>
              </div>
            </div>

            <!-- Backup Features Section -->
            <div class="mb-4">
              <h5 class="mb-3"><i class="fas fa-cloud-upload-alt me-2"></i>Backup Features</h5>
              <div class="row">
                <div class="col-4 mb-3">
                  <div class="form-check form-switch">
                    <input type="checkbox" class="form-check-input" name="retailease_google_drive_enabled"
                           id="googleDriveEnabled" {% if client.retailease_google_drive_enabled %}checked{% endif %}>
                    <label class="form-check-label" for="googleDriveEnabled">Google Drive Backup</label>
                  </div>
                </div>
                <div class="col-4 mb-3">
                  <div class="form-check form-switch">
                    <input type="checkbox" class="form-check-input" name="retailease_server_backup_enabled"
                           id="serverBackupEnabled" {% if client.retailease_server_backup_enabled %}checked{% endif %}>
                    <label class="form-check-label" for="serverBackupEnabled">Server Backup</label>
                  </div>
                </div>
                <div class="col-4 mb-3">
                  <div class="form-check form-switch">
                    <input type="checkbox" class="form-check-input" name="retailease_local_backup_enabled"
                           id="localBackupEnabled" {% if client.retailease_local_backup_enabled %}checked{% endif %}>
                    <label class="form-check-label" for="localBackupEnabled">Local Backup</label>
                  </div>
                </div>
              </div>
            </div>

            <!-- App Version Control Section -->
            <div class="mb-4">
              <h5 class="mb-3"><i class="fas fa-code-branch me-2"></i>App Version Control</h5>
              <div class="row">
                <div class="col-3 mb-3">
                  <label class="form-label">Min Version</label>
                  <input type="text" class="form-control" name="retailease_min_version"
                         value="{{ client.retailease_min_version|default:'1.0.0' }}" placeholder="1.0.0">
                </div>
                <div class="col-3 mb-3">
                  <label class="form-label">Latest Version</label>
                  <input type="text" class="form-control" name="retailease_latest_version"
                         value="{{ client.retailease_latest_version|default:'1.0.0' }}" placeholder="1.0.0">
                </div>
                <div class="col-4 mb-3">
                  <label class="form-label">Update URL</label>
                  <input type="url" class="form-control" name="retailease_update_url"
                         value="{{ client.retailease_update_url|default:'' }}" placeholder="https://example.com/download">
                </div>
                <div class="col-2 mb-3">
                  <label class="form-label">&nbsp;</label>
                  <div class="form-check form-switch mt-2">
                    <input type="checkbox" class="form-check-input" name="retailease_force_update"
                           id="forceUpdate" {% if client.retailease_force_update %}checked{% endif %}>
                    <label class="form-check-label" for="forceUpdate">Force Update</label>
                  </div>
                </div>
              </div>
            </div>

            <!-- Maintenance Mode Section -->
            <div class="mb-4">
              <h5 class="mb-3"><i class="fas fa-tools me-2"></i>Maintenance Mode</h5>
              <div class="row">
                <div class="col-3 mb-3">
                  <div class="form-check form-switch">
                    <input type="checkbox" class="form-check-input" name="retailease_maintenance_mode"
                           id="maintenanceMode" {% if client.retailease_maintenance_mode %}checked{% endif %}>
                    <label class="form-check-label" for="maintenanceMode">Enable Maintenance Mode</label>
                  </div>
                </div>
                <div class="col-9 mb-3">
                  <label class="form-label">Maintenance Message</label>
                  <textarea class="form-control" name="retailease_maintenance_message" rows="2"
                            placeholder="We're currently performing maintenance...">{{ client.retailease_maintenance_message|default:'' }}</textarea>
                </div>
              </div>
            </div>

            <!-- Support Contact Section -->
            <div class="mb-4">
              <h5 class="mb-3"><i class="fas fa-headset me-2"></i>Support Contact</h5>
              <div class="row">
                <div class="col-4 mb-3">
                  <label class="form-label">Support Email</label>
                  <input type="email" class="form-control" name="retailease_support_email"
                         value="{{ client.retailease_support_email|default:'' }}" placeholder="support@example.com">
                </div>
                <div class="col-4 mb-3">
                  <label class="form-label">Support Phone</label>
                  <input type="tel" class="form-control" name="retailease_support_phone"
                         value="{{ client.retailease_support_phone|default:'' }}" placeholder="+91 XXXXXXXXXX">
                </div>
                <div class="col-4 mb-3">
                  <label class="form-label">Support WhatsApp</label>
                  <input type="tel" class="form-control" name="retailease_support_whatsapp"
                         value="{{ client.retailease_support_whatsapp|default:'' }}" placeholder="+91 XXXXXXXXXX">
                </div>
              </div>
            </div>
          </div>

          <div class="card-footer" style="border-top: 1px solid var(--border-color); padding: 1rem;">
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-save me-2"></i>Save RetailEase Settings
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

      <!-- Backups Tab -->
      <div class="tab-content d-none" id="backupsTab">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">
              <i class="fas fa-cloud-upload-alt me-2 text-primary"></i>
              Server Backups
            </h3>
          </div>
          <div class="table-wrapper">
            <table class="table">
              <thead>
                <tr>
                  <th>Backup</th>
                  <th>Business</th>
                  <th>Counter</th>
                  <th>Size</th>
                  <th>Type</th>
                  <th>Created</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                {% for backup in backups %}
                <tr>
                  <td>
                    <div class="d-flex align-items-center gap-2">
                      <div class="avatar bg-primary-light">
                        <i class="fas fa-database text-primary"></i>
                      </div>
                      <div>
                        <div class="text-sm fw-medium">{{ backup.filename|truncatechars:30 }}</div>
                        <div class="text-xs text-muted">{{ backup.checksum|slice:":12" }}...</div>
                      </div>
                    </div>
                  </td>
                  <td>
                    <span class="text-sm">{{ backup.business.name }}</span>
                  </td>
                  <td>
                    <span class="text-sm">{{ backup.counter.name|default:"-" }}</span>
                  </td>
                  <td>
                    <span class="text-sm">{{ backup.file_size|filesizeformat }}</span>
                  </td>
                  <td>
                    {% if backup.backup_type == 'manual' %}
                    <span class="badge badge-primary">Manual</span>
                    {% elif backup.backup_type == 'auto' %}
                    <span class="badge badge-secondary">Auto</span>
                    {% else %}
                    <span class="badge badge-warning">Pre-Restore</span>
                    {% endif %}
                  </td>
                  <td>
                    <span class="text-sm">{{ backup.created_at|date:"M d, Y H:i" }}</span>
                  </td>
                  <td>
                    {% if backup.status == 'completed' %}
                    <span class="badge badge-success">Completed</span>
                    {% elif backup.status == 'failed' %}
                    <span class="badge badge-danger">Failed</span>
                    {% else %}
                    <span class="badge badge-warning">{{ backup.status|title }}</span>
                    {% endif %}
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="7" class="text-center py-4 text-muted">
                    <i class="fas fa-cloud-upload-alt mb-2" style="font-size: 2rem;"></i>
                    <p class="mb-0">No backups found for this client</p>
                    <small>Backups will appear here when the RetailEase app uploads them</small>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
{% endblock %}

{% block extra_js %}
<script>
function switchTab(tabId) {
  // Hide all tab contents
  document.querySelectorAll('.tab-content').forEach(content => {
    content.classList.add('d-none');
  });

  // Remove active class from all tabs
  document.querySelectorAll('.tab-item').forEach(tab => {
    tab.classList.remove('active');
  });

  // Show selected tab content
  document.getElementById(tabId).classList.remove('d-none');

  // Add active class to clicked tab
  document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
}

function toggleSecretVisibility() {
  const input = document.getElementById('clientSecret');
  const icon = document.getElementById('secretToggleIcon');

  if (input.type === 'password') {
    input.type = 'text';
    icon.classList.remove('fa-eye');
    icon.classList.add('fa-eye-slash');
  } else {
    input.type = 'password';
    icon.classList.remove('fa-eye-slash');
    icon.classList.add('fa-eye');
  }
}
</script>
{% endblock %}
