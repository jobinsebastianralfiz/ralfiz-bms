{% extends 'base.html' %}
{% load static %}

{% block title %}Delete {{ client.name }} - Ralfiz BMS{% endblock %}

{% block breadcrumb %}
<a href="{% url 'dashboard' %}" class="breadcrumb-item">Dashboard</a>
<span class="breadcrumb-separator">/</span>
<a href="{% url 'client_list' %}" class="breadcrumb-item">Clients</a>
<span class="breadcrumb-separator">/</span>
<a href="{% url 'client_detail' client.pk %}" class="breadcrumb-item">{{ client.name }}</a>
<span class="breadcrumb-separator">/</span>
<span class="breadcrumb-item active">Delete</span>
{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-6 col-md-8 col-sm-12" style="padding: 0.75rem;">
    <div class="card">
      <div class="card-header" style="background: var(--danger-bg); border-bottom-color: #fecaca;">
        <div class="d-flex align-items-center gap-3">
          <div style="width: 48px; height: 48px; background: var(--danger); border-radius: var(--border-radius); display: flex; align-items: center; justify-content: center;">
            <i class="fas fa-exclamation-triangle text-white" style="font-size: 1.25rem;"></i>
          </div>
          <div>
            <h3 class="card-title mb-0" style="color: var(--danger);">Delete Client</h3>
            <p class="text-sm mb-0" style="color: var(--danger);">This action cannot be undone</p>
          </div>
        </div>
      </div>
      <div class="card-body">
        <p class="text-secondary mb-4">
          Are you sure you want to delete the client <strong>"{{ client.name }}"</strong>?
          {% if client.company_name %}({{ client.company_name }}){% endif %}
        </p>

        <!-- Client Summary -->
        <div class="p-3 rounded mb-4" style="background: var(--bg-body);">
          <div class="d-flex align-items-center gap-3 mb-3">
            <div class="avatar">{{ client.name|slice:":2"|upper }}</div>
            <div>
              <div class="fw-medium">{{ client.name }}</div>
              <div class="text-sm text-muted">{{ client.email }}</div>
            </div>
          </div>
          <div class="row">
            <div class="col-4">
              <div class="text-sm text-muted">Projects</div>
              <div class="fw-medium">{{ client.projects.count }}</div>
            </div>
            <div class="col-4">
              <div class="text-sm text-muted">Invoices</div>
              <div class="fw-medium">{{ client.invoices.count }}</div>
            </div>
            <div class="col-4">
              <div class="text-sm text-muted">Quotes</div>
              <div class="fw-medium">{{ client.quotes.count }}</div>
            </div>
          </div>
        </div>

        {% if client.projects.count > 0 or client.invoices.count > 0 or client.quotes.count > 0 %}
        <div class="alert alert-warning">
          <i class="fas fa-info-circle alert-icon"></i>
          <div class="alert-content">
            <div class="alert-title">Cannot delete this client</div>
            <p class="alert-text mb-0">
              This client has associated records. Please delete or reassign the following first:
              {% if client.projects.count > 0 %}{{ client.projects.count }} project(s){% endif %}
              {% if client.invoices.count > 0 %}{% if client.projects.count > 0 %}, {% endif %}{{ client.invoices.count }} invoice(s){% endif %}
              {% if client.quotes.count > 0 %}{% if client.projects.count > 0 or client.invoices.count > 0 %}, {% endif %}{{ client.quotes.count }} quote(s){% endif %}
            </p>
          </div>
        </div>
        {% endif %}

        <form method="post" class="d-flex gap-3 justify-content-end mt-4">
          {% csrf_token %}
          <a href="{% url 'client_detail' client.pk %}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left"></i>
            Cancel
          </a>
          <button type="submit" class="btn btn-danger" {% if client.projects.count > 0 or client.invoices.count > 0 or client.quotes.count > 0 %}disabled{% endif %}>
            <i class="fas fa-trash-alt"></i>
            Delete Client
          </button>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}
